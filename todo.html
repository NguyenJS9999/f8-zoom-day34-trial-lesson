<!DOCTYPE html>
<html lang="vi">

<head>
    <meta charset="UTF-8" />
    <title>Todo List</title>
    <script src="https://unpkg.com/react@18/umd/react.development.js"></script>
    <script src="https://unpkg.com/react-dom@18/umd/react-dom.development.js"></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>

    <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.5.2/css/bootstrap.min.css" />


    <link rel="stylesheet" href="./css/common.css">
    <link rel="stylesheet" href="./css/todo.css">

</head>

<body>
    <div id="root"></div>
    <script type="text/babel">
        const { useState } = React;
        let uniqId = 0;

        function TodoApp() {
            const [inputValue,setInputValue] = useState('');
            const [todos,setTodos] = useState([]);

            const handleSubmitForm = (e) => {
                if (inputValue.trim()) {
                    setTodos([...todos,{ id: ++uniqId,text: inputValue,completed: false }]);
                    setInputValue('');
                }
            };

            const toggleComplete = (id) => {
                const totoCompleted = todos.find(todo => todo.id === id).completed;

                // setTodos(todos.map(todo => todo.id === id ? { ...todo,completed: !todo.completed } : todo));
                setTodos(todos.map(todo => {
                    if (todo.id === id) {
                        return { ...todo,completed: !totoCompleted };
                    }
                    return todo;
                }));
            };

            const deleteThisTodo = (id) => {
                setTodos(todos.filter(todo => todo.id !== id));
            };

            const stats = {
                total: todos.length,
                completed: todos.filter(todo => todo.completed).length,
            };
            stats.remaining = stats.total - stats.completed;

            return (
                <div className="container">
                    <h1>Todo List</h1>

                    <div className="form-count mb-3 d-flex align-items-center gap-2">
                        <input
                            type="text"
                            className="form-control mr-2"
                            name="todo"
                            value={inputValue}
                            onChange={(e) => setInputValue(e.target.value)}
                            placeholder="Nhập task mới..."
                        />
                        <button type="button" className="btn btn-primary" onClick={handleSubmitForm}>Thêm</button>
                    </div>

                    {todos.length === 0 ? (
                        <p>Chưa có task nào. Hãy thêm task đầu tiên!</p>
                    ) : (
                        <ul>
                            {todos.map(todo => (
                                <li key={todo.id} className="todo-list">
                                    <input
                                        type="checkbox"
                                        checked={todo.completed}
                                        onChange={() => toggleComplete(todo.id)}
                                    />
                                    <span className={todo.completed ? 'done' : ''}>{todo.text}</span>
                                    <button className="btn btn-danger" onClick={() => deleteThisTodo(todo.id)}>Xóa</button>
                                </li>
                            ))}
                        </ul>
                    )}

                    <div className="my-element" />
                    <p>
                        Tổng: {stats.total} | Hoàn thành: {stats.completed} | Còn lại: {stats.remaining}
                    </p>
                </div>
            );
        }

        ReactDOM.createRoot(document.getElementById("root")).render(<TodoApp />);
    </script>
</body>

</html>
